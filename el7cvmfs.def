Bootstrap: docker
From: adriansevcenco/el7cvmfs

%labels
    Author Adrian.Sevcenco@spacescience.ro
    Version 0.0.1
    Description Minimal el7, HEP_OSlibs + cvmfs (configs: default+egi+osg) container


%help
Generic HEP oriented container (it includes HEP_OSlibs dependency list)
that allows mounting of CVMFS repositories without any host requirement.
The proxies are defined as generic PAC urls, with fallback to DIRECT.
CVMFS configuration is the merge of cvmfs-config-default cvmfs-config-egi cvmfs-config-osg
The container can be pre-setup by the usage of files prefixed with CVMFS2GO_EXEC_ or CVMFS2GO_LOAD_
that are searched in the current directory and in $HOME (if not found in cwd).
If given as 1st argument a name that start with CVMFS2GO_LOAD_ it will be sourced before running a command or starting the shell
If given as 1st argument a name that start with CVMFS2GO_EXEC_ the first line of file will be executed
The default is either run the argument list or just start bash

%runscript
ARG="${1}"

if [[ ${ARG} == CVMFS2GO_LOAD_*  ]]; then
    shift
    # check existence of file in current dir then in $HOME
    if [[ -e ./${ARG} ]]; then
        source ./${ARG}
    elif [[ -e ${HOME}/${ARG} ]]; then
        source ${HOME}/${ARG}
    fi
fi

if [[ ${ARG} == CVMFS2GO_EXEC_*  ]]; then
    shift
    # check existence of file in current dir then in $HOME
    if [[ -e ${ARG} ]]; then
        exec $(head -1 ${ARG})
    elif [[ -e ${HOME}/${ARG} ]]; then
        exec $(head -1 ${HOME}/${ARG})
    fi
fi

[[ -n "${@}" ]] && exec "${@}" || exec bash

